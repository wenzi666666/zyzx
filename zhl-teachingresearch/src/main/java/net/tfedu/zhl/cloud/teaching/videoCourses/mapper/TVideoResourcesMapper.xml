<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.tfedu.zhl.cloud.teaching.videoCourses.dao.TVideoResourcesMapper" >
  <resultMap id="BaseResultMap" type="net.tfedu.zhl.cloud.teaching.videoCourses.entity.TVideoResources" >
    <!--
      WARNING - @mbggenerated
    -->
    <constructor>
      <idArg column="id" jdbcType="BIGINT" javaType="java.lang.Long" />
      <arg column="title" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="playtime" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="speakerinfo" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="clicktimes" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="fromflag" jdbcType="BIT" javaType="java.lang.Boolean" />
      <arg column="typeId" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="subjectId" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="fname" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="thumbnailpath" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="creator" jdbcType="BIGINT" javaType="java.lang.Long" />
      <arg column="createDate" jdbcType="DATE" javaType="java.util.Date" />
      <arg column="updateDate" jdbcType="DATE" javaType="java.util.Date" />
      <arg column="flag" jdbcType="BIT" javaType="java.lang.Boolean" />
      <arg column="description" jdbcType="LONGVARCHAR" javaType="java.lang.String" />
    </constructor>
  </resultMap>
  
  <!-- 分页查询视频课程  -->
  <select id="getAllVideoCourses" resultType="net.tfedu.zhl.cloud.teaching.videoCourses.entity.TVideoResources">
  select id,title,speakerinfo,description,playtime,
  (select AVG(score) as avgScore from t_videocomments where userId = #{userId} and videoId = a.id) as avgScore,
  clicktimes,(select count(id) as count from t_viewedvideos where videoId = a.id and userId = #{userId}) as hasVisited,thumbnailpath
  from t_videoresources a 
  where fromflag = #{fromFlag} and typeId = #{typeId} and subjectId = #{subjectId}
  <if test="orderBy == 0">
     order by a.playtime
  </if>
  
  <if test="orderBy == 1">
     order by a.playtime desc
  </if>
  
  <if test="orderBy == 2">
     order by a.clicktimes desc
  </if>
  
  <if test="orderBy == 3">
     order by avgScore desc
  </if>
  </select>
  
  <!-- 预览一条视频课程 -->
  <select id="getOneVideoCourse" resultType="net.tfedu.zhl.cloud.teaching.videoCourses.entity.VideoPreviewEntity">
     select id,title,(select score as score from t_videocomments where userId = #{userId} and videoId = #{videoId}) as score,fname
     from t_videocomments where id = #{videoId}
  </select>
</mapper>